<div class="user-search-container">
    <div class="header">
        <h1 class="title">
            <mat-icon>{{ isFriendsMode ? 'group' : 'people' }}</mat-icon>
            {{ isFriendsMode ? 'Mes Amis' : 'Rechercher des utilisateurs' }}
        </h1>
        <p class="subtitle">{{ isFriendsMode ? 'Vos amis et demandes en attente' : 'Trouvez et connectez-vous avec
            d\'autres utilisateurs' }}</p>
    </div>

    <div class="search-bar">
        <div class="search-container">
            <mat-form-field appearance="outline" class="search-field" [subscriptSizing]="'dynamic'">
                <mat-icon matPrefix>search</mat-icon>
                <input matInput [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()"
                    placeholder="Rechercher par nom..." type="text">
                <button *ngIf="searchQuery" matSuffix mat-icon-button (click)="searchQuery = ''; onSearchChange()"
                    aria-label="Clear">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-form-field>
            <button *ngIf="isFriendsMode" mat-mini-fab class="add-friend-mini-btn" (click)="openAddFriendDialog()"
                title="Ajouter un ami">
                <mat-icon>person_add</mat-icon>
            </button>
        </div>
    </div>

    <!-- Tabs (Persistent) -->
    <!-- Tabs (Persistent) -->
    <div class="tabs-container" *ngIf="isFriendsMode">
        <!-- Desktop Tabs -->
        <mat-tab-group *ngIf="!isMobile" [selectedIndex]="activeTabIndex" (selectedIndexChange)="onTabChange($event)"
            animationDuration="0ms">
            <mat-tab label="Amis"></mat-tab>
            <mat-tab label="Demandes envoyées"></mat-tab>
            <mat-tab label="Demandes reçues"></mat-tab>
        </mat-tab-group>

        <!-- Mobile Tabs Navigation -->
        <div class="mobile-tabs-nav" *ngIf="isMobile">
            <button mat-icon-button (click)="prevTab()" [disabled]="activeTabIndex === 0">
                <mat-icon>chevron_left</mat-icon>
            </button>
            <span class="current-tab-label">{{ tabLabels[activeTabIndex] }}</span>
            <button mat-icon-button (click)="nextTab()" [disabled]="activeTabIndex === 2">
                <mat-icon>chevron_right</mat-icon>
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Chargement des utilisateurs...</p>
    </div>

    <!-- Error State -->
    <div class="error-state" *ngIf="error && !isLoading">
        <mat-icon>error_outline</mat-icon>
        <p>{{ error }}</p>
        <button mat-raised-button (click)="loadUsers()">Réessayer</button>
    </div>

    <!-- Content -->
    <div class="content-wrapper" *ngIf="!isLoading && !error">
        <ng-container *ngTemplateOutlet="usersGrid"></ng-container>
    </div>

    <ng-template #usersGrid>
        <div class="users-grid">
            <div class="empty-state" *ngIf="filteredUsers.length === 0">
                <mat-icon>person_search</mat-icon>
                <p>Aucun utilisateur trouvé</p>
                <span class="hint">Essayez une autre recherche</span>
            </div>

            <app-user-card *ngFor="let user of filteredUsers" [user]="user" [showFriendBadge]="!isFriendsMode"
                (addFriend)="onAddFriend($event)" (acceptFriend)="onAcceptFriend($event)"
                (declineFriend)="onDeclineFriend($event)">
            </app-user-card>
        </div>
    </ng-template>
</div>