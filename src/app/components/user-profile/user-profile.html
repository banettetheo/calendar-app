<div class="skeleton-profile-container" *ngIf="isLoading">
    <div class="profile-header">
        <div class="banner skeleton"></div>
        <div class="header-content">
            <div class="avatar-container">
                <div class="avatar skeleton"></div>
            </div>
            <div class="user-identity">
                <div class="skeleton skeleton-title"></div>
                <div class="badges">
                    <div class="skeleton skeleton-chip"></div>
                    <div class="skeleton skeleton-chip"></div>
                </div>
            </div>
            <div class="actions">
                <div class="skeleton skeleton-chip" style="width: 100px; height: 40px; border-radius: 12px;"></div>
                <div class="skeleton skeleton-chip" style="width: 100px; height: 40px; border-radius: 12px;"></div>
            </div>
        </div>
    </div>

    <div class="profile-grid">
        <div class="main-info">
            <div class="stats-row">
                <div class="stat-card skeleton"></div>
                <div class="stat-card skeleton"></div>
                <div class="stat-card skeleton"></div>
            </div>
            <div class="info-card">
                <div class="skeleton skeleton-title" style="width: 30%;"></div>
                <div class="details-list">
                    <div class="detail-item" *ngFor="let i of [1,2,3,4]">
                        <div class="skeleton skeleton-text" style="width: 40%; height: 20px;"></div>
                        <div class="skeleton skeleton-text" style="width: 25%; height: 20px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="secondary-info">
            <div class="info-card skeleton" style="height: 320px; border: none;"></div>
        </div>
    </div>
</div>

<div class="profile-container fade-in" *ngIf="!isLoading && user">
    <!-- Header Section -->
    <div class="profile-header">
        <div class="banner"></div>
        <div class="header-content">
            <div class="avatar-container" (click)="openAvatarDialog()">
                <div class="avatar" [class.has-image]="user.profilePicUrl">
                    <img *ngIf="user.profilePicUrl" [src]="user.profilePicUrl" alt="Avatar" class="avatar-image">
                    <span *ngIf="!user.profilePicUrl" class="avatar-initials">
                        {{ user.firstName?.[0] || 'U' }}{{ user.lastName?.[0] || '' }}
                    </span>
                </div>
                <div class="avatar-overlay">
                    <mat-icon>photo_camera</mat-icon>
                    <span>Modifier</span>
                </div>
            </div>


            <div class="user-identity">
                <h1>{{ user.username }}</h1>
                <div class="badges">
                    <span class="role-badge" *ngIf="user.jobTitle">
                        <mat-icon>work</mat-icon>
                        {{ user.jobTitle }}
                    </span>
                    <span class="location-badge" *ngIf="user.location">
                        <mat-icon>place</mat-icon>
                        {{ user.location }}
                    </span>
                </div>
            </div>

            <div class="actions">
                <button mat-stroked-button class="edit-btn" (click)="openEditDialog()">
                    <mat-icon>edit</mat-icon>
                    Modifier
                </button>
                <button mat-flat-button color="primary" class="contact-btn">
                    <mat-icon>mail</mat-icon>
                    Contacter
                </button>
            </div>
        </div>
    </div>

    <div class="profile-grid">
        <!-- Left Column: Info & Skills -->
        <div class="main-info">
            <!-- Stats Cards -->
            <div class="stats-row" *ngIf="user.stats">
                <div class="stat-card">
                    <div class="stat-value">{{ user.stats?.projectsCompleted || 0 }}</div>
                    <div class="stat-label">Projets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ user.stats?.hoursLogged || 0 }}h</div>
                    <div class="stat-label">Heures</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ user.stats?.efficiency || 0 }}%</div>
                    <div class="stat-label">Efficacité</div>
                </div>
            </div>

            <div class="info-card">
                <h3>À propos</h3>
                <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>

                <div class="details-list">
                    <div class="detail-item">
                        <span class="label">Prénom</span>
                        <span class="value">{{ user.firstName }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Nom</span>
                        <span class="value">{{ user.lastName }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Email</span>
                        <span class="value">{{ user.email }}</span>
                    </div>
                    <div class="detail-item" *ngIf="user.department">
                        <span class="label">Département</span>
                        <span class="value">{{ user.department }}</span>
                    </div>
                    <div class="detail-item" *ngIf="user.parsedJoinedDate">
                        <span class="label">Membre depuis</span>
                        <span class="value">{{ user.parsedJoinedDate | date:'longDate' }}</span>
                    </div>
                </div>
            </div>

            <div class="info-card" *ngIf="user.skills && user.skills.length > 0">
                <h3>Compétences</h3>
                <div class="skills-wrapper">
                    <span *ngFor="let skill of user.skills" class="skill-chip">
                        {{ skill }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Right Column: Projects & Activity -->
        <div class="secondary-info" *ngIf="user.projects && user.projects.length > 0">
            <div class="info-card projects-card">
                <div class="card-header">
                    <h3>Projets Récents</h3>
                    <button mat-icon-button>
                        <mat-icon>arrow_forward</mat-icon>
                    </button>
                </div>

                <div class="projects-list">
                    <div *ngFor="let project of user.projects" class="project-item">
                        <div class="project-icon" [style.background]="project.color + '20'"
                            [style.color]="project.color">
                            <mat-icon>folder</mat-icon>
                        </div>
                        <div class="project-info">
                            <span class="project-name">{{ project.name }}</span>
                            <span class="project-role">{{ project.role }}</span>
                        </div>
                        <span class="status-badge" [class]="project.status">
                            {{ project.status }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>